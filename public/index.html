<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Sanjuli â€” Firebase Google Login</title>
    <style>
      body{font-family:system-ui,Segoe UI,Roboto,Arial;padding:2rem}
      .card{max-width:520px;margin:0 auto;padding:1rem;border:1px solid #eee;border-radius:8px}
      button{padding:.6rem 1rem;border-radius:6px}
      .user{margin-top:1rem}
    </style>
  </head>
  <body>
    <script type="module" src="./menu.js"></script>

    <div class="card">
      <h1>Welcome</h1>
      <p>Open the <a href="/login.html">Login page</a> to sign in and be redirected to the protected page.</p>
    </div>

    <script type="module">
      import { signInWithGoogle, signOutUser, onAuthChange } from './firebase-client.js';

      const authToggle = document.getElementById('authToggle');
      const authDropdown = document.getElementById('authDropdown');
      const navSignIn = document.getElementById('navSignIn');
      const navSignOut = document.getElementById('navSignOut');
      const authInfo = document.getElementById('authInfo');
      const navUserName = document.getElementById('navUserName');
      const navUserPhoto = document.getElementById('navUserPhoto');

      authToggle.addEventListener('click', () => {
        authDropdown.style.display = authDropdown.style.display === 'block' ? 'none' : 'block';
      });

      navSignIn.addEventListener('click', async () => {
        try {
          await signInWithGoogle('/protected.html');
        } catch (e) {
          alert('Sign-in failed');
        }
      });

      navSignOut.addEventListener('click', async () => {
        await signOutUser();
        authDropdown.style.display = 'none';
      });

      onAuthChange(user => {
        if (user) {
          navSignIn.style.display = 'none';
          navSignOut.style.display = 'block';
          authInfo.style.display = 'block';
          navUserName.textContent = user.displayName || user.email;
          navUserPhoto.src = user.photoURL || '';
        } else {
          navSignIn.style.display = 'block';
          navSignOut.style.display = 'none';
          authInfo.style.display = 'none';
          navUserName.textContent = '';
          navUserPhoto.src = '';
        }
      });
    </script>
  </body>
</html>
